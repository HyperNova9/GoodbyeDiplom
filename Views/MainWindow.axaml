<Window xmlns="https://github.com/avaloniaui"
        xmlns:x="http://schemas.microsoft.com/winfx/2006/xaml"
        xmlns:vm="using:GoodbyeDiplom.ViewModels"
        xmlns:d="http://schemas.microsoft.com/expression/blend/2008"
        xmlns:mc="http://schemas.openxmlformats.org/markup-compatibility/2006"
        mc:Ignorable="d" d:DesignWidth="1200" d:DesignHeight="800"
        x:Class="GoodbyeDiplom.Views.MainWindow"
        x:DataType="vm:MainWindowViewModel"
        Icon="/Assets/avalonia-logo.ico"
        Title="3D Function Grapher"
        WindowState="Maximized">
    <Design.DataContext>
        <vm:MainWindowViewModel/>
    </Design.DataContext>
    
    <Grid>
        <Grid.ColumnDefinitions>
            <ColumnDefinition Width="*"/>  <!-- График -->
            <ColumnDefinition Width="300"/> <!-- Панель управления -->
        </Grid.ColumnDefinitions>
        
        <!-- Основной график -->
        <Grid Grid.Column="0">
            <Grid.RowDefinitions>
                <RowDefinition Height="*"/>  <!-- Основное пространство -->
                <RowDefinition Height="Auto"/> <!-- Панель статуса -->
            </Grid.RowDefinitions>
            <Canvas Grid.Row="0" Grid.Column="0" x:Name="MainCanvas"/>
            
            <Grid Grid.Row="1" Height="40" Background="#EEE"> 
                <Grid.ColumnDefinitions>
                    <ColumnDefinition Width="*"/>
                    <ColumnDefinition Width="Auto"/>
                    <ColumnDefinition Width="Auto"/>
                </Grid.ColumnDefinitions>
                
                <TextBlock Text="{Binding GridCoordinates}" 
                        VerticalAlignment="Center"
                        Margin="10,0"
                        FontSize="12"/>
                <StackPanel Grid.Column="1" Orientation="Horizontal" Margin="0,0,10,0">
                    <Button Content="Сохранить _PNG" Margin="5,0" Click="SaveToPng_Click"/>
                    <Button Content="Сохранить JSON" Margin="5,0" Click="SaveToJson_Click"/>
                    <Button Content="Загрузить JSON" Margin="5,0" Click="LoadFromJson_Click"/>
                </StackPanel>
                <StackPanel Grid.Column="2" Orientation="Horizontal" Margin="0,0,10,0">
                    <Button Content="+" Width="30" Margin="5,0" Click="ZoomIn_Click"/>
                    <Button Content="-" Width="30" Margin="5,0" Click="ZoomOut_Click"/>
                    <Button Content="←" Width="30" Margin="5,0" Click="RotateRight_Click"/>
                    <Button Content="→" Width="30" Margin="5,0" Click="RotateLeft_Click"/>
                </StackPanel>
            </Grid>
        </Grid>
        
        <!-- Правая панель управления -->
        <Grid Grid.Column="1" Background="#F5F5F5">
            <Grid.RowDefinitions>
                <RowDefinition Height="Auto"/>
                <RowDefinition Height="Auto"/>
                <RowDefinition Height="Auto"/>
                <RowDefinition Height="Auto"/>
            </Grid.RowDefinitions>
           <Border Grid.Row="0" Margin="10" BorderBrush="#e3e3e3" 
           BorderThickness="1" CornerRadius="4">
                <StackPanel>
                    <TextBlock Text="Список функций" 
                            Margin="5" 
                            FontWeight="Bold"
                            Background="#EEE"
                            Padding="5"/>
                    
                    <ListBox x:Name="FunctionsList" 
                            ItemsSource="{Binding Functions}" 
                            SelectedItem="{Binding SelectedFunction, Mode=TwoWay}"
                            Height="150"
                            Margin="5">
                        <ListBox.DataTemplates>
                            <DataTemplate DataType="vm:FunctionModel">
                                <StackPanel Orientation="Horizontal" Margin="5" HorizontalAlignment="Center">
                                    <TextBlock Text="{Binding Name}" Margin="2"/>
                                    <CheckBox IsChecked="{Binding IsVisible}" Margin="5,0,5,0"
                                    Click="UpdateGridFromVM"/>
                                </StackPanel>
                            </DataTemplate>
                        </ListBox.DataTemplates>
                    </ListBox>
                    
                    <StackPanel Orientation="Horizontal" Margin="5" HorizontalAlignment="Center">
                        <Button x:Name="PlusButton" Content="+" Margin="0,0,5,0" Width="30" Command="{Binding AddFunctionCommand}"/>
                        <Button Content="-" Margin="5,0,0,0" Width="30" Command="{Binding RemoveFunctionCommand}"/>
                    </StackPanel>
                </StackPanel>
            </Border>
            <!-- Параметры выбранной функции -->
            <Expander Grid.Row="1" Margin="5" Width="290" Header="Параметры функции">
                <StackPanel>           
                    <TextBox Text="{Binding SelectedFunction.Name, Mode=TwoWay}"
                            Watermark="Название функции"
                            Margin="5,0,5,5"/>
                    
                    <TextBox Text="{Binding SelectedFunction.Expression, Mode=TwoWay}"
                            AcceptsReturn="True"
                            TextWrapping="Wrap"
                            FontFamily="Consolas"
                            Height="100"
                            Margin="5,0,5,5"
                            TextChanged="OnFunctionExpressionChanged"/>
                    
                    <StackPanel Orientation="Horizontal" Margin="5,0,5,5">
                        <TextBlock Text="Цвет:" VerticalAlignment="Center" Width="100"/>
                        <ColorPicker Color="{Binding StartColor, Mode=TwoWay}"
                        ColorChanged="OnFunctionColorStartChanged" Width="60" Height="30"/>
                        <ColorPicker Color="{Binding EndColor, Mode=TwoWay}"
                        ColorChanged="OnFunctionColorEndChanged" Width="60" Height="30"/>
                    </StackPanel>
        
                    <StackPanel Orientation="Horizontal" Margin="5,0,5,5">
                        <TextBlock Text="Шаг сетки:" VerticalAlignment="Center" Width="100"/>
                        <Slider Minimum="1" Maximum="100" 
                            Value="{Binding StepSize, Mode=TwoWay}"
                            Width="100" VerticalAlignment="Center"
                            ValueChanged="OnFunctionStepSizeChanged"/>
                        <TextBlock Text="{Binding StepSize, StringFormat='{}{0:F2}'}" 
                                Margin="10,0" VerticalAlignment="Center"/>
                    </StackPanel>
                    <StackPanel Orientation="Horizontal" Margin="5,0,5,5">
                        <TextBlock Text="Шаг цвета:" VerticalAlignment="Center" Width="100"/>
                        <Slider Minimum="2" Maximum="50" 
                            Value="{Binding StepColor, Mode=TwoWay}"
                            Width="100" VerticalAlignment="Center"
                            ValueChanged="OnFunctionStepColorChanged"/>
                        <TextBlock Text="{Binding StepColor, StringFormat='{}{0:F2}'}" 
                                Margin="10,0" VerticalAlignment="Center"/>
                    </StackPanel>
                </StackPanel>
            </Expander>


            <!-- Группа "Видимость элементов" -->
            <Expander Grid.Row="2" Margin="5" Width="290" Header="Видимость элементов">
                <StackPanel>
                    <CheckBox Content="Оси координат" 
                            IsChecked="{Binding ShowAxes}" Margin="5,0,5,0"
                            Click="UpdateGridFromVM"/>
                    <CheckBox Content="Подписи осей" 
                            IsChecked="{Binding ShowLabels}" Margin="5,0,5,0"
                            Click="UpdateGridFromVM"/>
                    <CheckBox Content="Кубический каркас" 
                            IsChecked="{Binding ShowCube}" Margin="5,0,5,0"
                            Click="UpdateGridFromVM"/>
                    <CheckBox Content="Координатная сетка" 
                            IsChecked="{Binding ShowGrid}" Margin="5,0,5,0"
                            Click="UpdateGridFromVM"/>
                    <CheckBox Content="График поверхности" 
                            IsChecked="{Binding ShowGraphic}" Margin="5,0,5,0"
                            Click="UpdateGridFromVM"/>
                </StackPanel>
            </Expander>
            <Expander Grid.Row="3" Margin="5" Width="290" Header="Изменение цвета сцены">
                <StackPanel>
                    <StackPanel Orientation="Horizontal" Margin="5,0,5,5">
                        <StackPanel>
                            <TextBlock Text="X" 
                            Margin="5" 
                            FontWeight="Bold"
                            Padding="5"/>
                            <ColorPicker Width="60" Height="30" Color="{Binding ColorsScene.ColorX, Mode=TwoWay}"
                            ColorChanged="OnColorChanged"/>
                        </StackPanel>
                        <StackPanel>
                            <TextBlock Text="Y" 
                            Margin="5" 
                            FontWeight="Bold"
                            Padding="5"/>
                            <ColorPicker Width="60" Height="30" Color="{Binding ColorsScene.ColorY, Mode=TwoWay}"
                            ColorChanged="OnColorChanged"/>
                        </StackPanel>
                        <StackPanel>
                            <TextBlock Text="Z" 
                            Margin="5" 
                            FontWeight="Bold"
                            Padding="5"/>
                            <ColorPicker Width="60" Height="30" Color="{Binding ColorsScene.ColorZ, Mode=TwoWay}"
                            ColorChanged="OnColorChanged"/>
                        </StackPanel>
                    </StackPanel>
                    <TextBlock Text="Цвет фона сцены" 
                        Margin="5" 
                        FontWeight="Bold"
                        Padding="5"/>
                    <ColorPicker Width="120" Height="30" Color="{Binding ColorsScene.ColorBG, Mode=TwoWay}"
                    ColorChanged="OnColorChanged"/>
                    <TextBlock Text="Цвет кубического каркаса" 
                        Margin="5" 
                        FontWeight="Bold"
                        Padding="5"/>
                    <ColorPicker Width="120" Height="30" Color="{Binding ColorsScene.ColorCube, Mode=TwoWay}"
                    ColorChanged="OnColorChanged"/>
                    <TextBlock Text="Цвет сетки" 
                        Margin="5" 
                        FontWeight="Bold"
                        Padding="5"/>
                    <ColorPicker Width="120" Height="30" Color="{Binding ColorsScene.ColorGrid, Mode=TwoWay}"
                    ColorChanged="OnColorChanged"/>
                </StackPanel>
            </Expander>
        </Grid>
    </Grid>
</Window>